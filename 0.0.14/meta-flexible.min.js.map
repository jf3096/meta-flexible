{"version":3,"file":"meta-flexible.min.js","sources":["../src/index.js"],"sourcesContent":["(function (window, document, apiMetaFlexibleOptions) {\r\n  /**\r\n   * 标记版本, 自动生成版本号\r\n   * @type {string}\r\n   */\r\n  apiMetaFlexibleOptions.version = '<@VERSION@>';\r\n\r\n  /**\r\n   * 计算文字大小比例差, 用于检查用户在手机浏览器中发大了字体导致响应式失效\r\n   */\r\n  const computeDiffFontSizeRatio = (() => {\r\n    let diffFontSizeRatio;\r\n    /**\r\n     * 当前实际字体大小, 用于检查用户在手机浏览器中发大了字体导致响应式失效\r\n     * @returns {number}\r\n     */\r\n    const computeActualFontSize = () => {\r\n      return +getComputedStyle(document.documentElement).getPropertyValue('font-size').replace(/px/, '');\r\n    };\r\n    return () => {\r\n      if (!diffFontSizeRatio) {\r\n        const rawDocElementCssText = document.documentElement.style.cssText;\r\n        document.documentElement.style.cssText = 'font-size:100px !important';\r\n        const docElementStyleFontSize = 100;\r\n        const actualFontSize = computeActualFontSize();\r\n        diffFontSizeRatio = actualFontSize / docElementStyleFontSize;\r\n        document.documentElement.style.cssText = rawDocElementCssText;\r\n      }\r\n      return diffFontSizeRatio;\r\n    };\r\n  })();\r\n\r\n  /**\r\n   * 方案枚举\r\n   */\r\n  const Plan = {\r\n    TargetDensityDpi: 0,\r\n    ScaleRatio: 1,\r\n    Rem: 2,\r\n    Viewpoint: 3\r\n  };\r\n\r\n  /**\r\n   * 是否有生效, 用于判断当前方案是否真正生效\r\n   */\r\n  const Impact = {\r\n    Yes: 1,\r\n    No: -1,\r\n    Unknown: 0\r\n  };\r\n\r\n  /**\r\n   * rem 调节大小依赖\r\n   * @type {{Auto: string, Height: string, Width: string}}\r\n   */\r\n  const RemResizeDependency = {\r\n    Width: 'width',\r\n    Height: 'height',\r\n    Auto: 'auto',\r\n    UseBiggerSize: 'useBiggerSize',\r\n    UseSmallerSize: 'useSmallerSize'\r\n  };\r\n\r\n  /**\r\n   * no operation\r\n   * @param f\r\n   * @returns {*}\r\n   */\r\n  const noop = f => f;\r\n\r\n  /**\r\n   *  默认options, 当前client属性为保留字段, 可接受 'pc' | 'mobile'\r\n   * @type {{enableBodyFontSize: boolean, enableViewpointFitForIphoneX: boolean, disableReportPlanNotWorkingErrorOnce: boolean, Plan: {ScaleRatio: number, Viewpoint: number, Rem: number, TargetDensityDpi: number}, onBeforeApplyPlan: (function(*): *), designViewpoint: number, remUpperResizeLimit: number, plans: number[], remResizeDependency: string, namespace: string, fixRemManualSettingFontResize: boolean, client: undefined, getMetaViewpointScaleRatioContent(*, *=): string, applyResponsePlanOnce: boolean, isMobile: (function(): boolean), remRatio: number, getMetaViewpointTargetDensityDpiContent(*, *=): string}}\r\n   */\r\n  const defaultMetaFlexibleOptions = {\r\n    /**\r\n     * 日志命名空间\r\n     */\r\n    namespace: 'meta-flexible',\r\n    /**\r\n     * 根据设计稿大小设置即可\r\n     */\r\n    designViewpoint: 750,\r\n    /**\r\n     * meta viewpoint content, 细节请参考返回值\r\n     * @param designViewpoint\r\n     * @param enableViewpointFitForIphoneX\r\n     * @return {string}\r\n     */\r\n    getMetaViewpointTargetDensityDpiContent(designViewpoint, enableViewpointFitForIphoneX) {\r\n      return [\r\n        `width=${designViewpoint}`,\r\n        'target-densitydpi=device-dpi',\r\n        'user-scalable=no',\r\n        enableViewpointFitForIphoneX && 'viewport-fit=cover',\r\n      ].filter(Boolean).join(', ');\r\n    },\r\n    /**\r\n     * meta viewpoint content, 细节请参考返回值\r\n     * @param scale\r\n     * @param enableViewpointFitForIphoneX\r\n     * @return {string}\r\n     */\r\n    getMetaViewpointScaleRatioContent(scale, enableViewpointFitForIphoneX) {\r\n      return [\r\n        'width=device-width',\r\n        'initial-scale=1',\r\n        `maximum-scale=${scale}`,\r\n        `minimum-scale=${scale}`,\r\n        'user-scalable=no',\r\n        enableViewpointFitForIphoneX && 'viewport-fit=cover'\r\n      ].filter(Boolean).join(', ');\r\n    },\r\n    /**\r\n     * 判断是否是移动端\r\n     * @return {boolean}\r\n     */\r\n    isMobile: () => /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|HuaweiBrowser|ArkWeb/i.test(navigator.userAgent),\r\n    /**\r\n     * 降级方案顺序\r\n     */\r\n    plans: [Plan.TargetDensityDpi, Plan.ScaleRatio],\r\n    /**\r\n     * 方案枚举\r\n     */\r\n    Plan,\r\n    /**\r\n     * 是否设置body字体\r\n     */\r\n    enableBodyFontSize: false,\r\n    /**\r\n     * 是否开启viewpoint fit\r\n     */\r\n    enableViewpointFitForIphoneX: false,\r\n    /**\r\n     * rem 比例\r\n     */\r\n    remRatio: 10,\r\n    /**\r\n     * rem最大上限, 通过设置该字段防止页面无限放大\r\n     */\r\n    remUpperResizeLimit: 540,\r\n    /*\r\n     * rem 缩放基准依赖, 有效值为 width|height|auto\r\n     * 当缩放基准依赖为 width 时, 页面会根据宽度缩放而变化 html root 的 fontSize 大小\r\n     * 当缩放基准依赖为 height 时, 页面会根据高度缩放而变化 html root 的 fontSize 大小\r\n     * 当缩放基准依赖为 auto 时, 页面会根据宽高比决定, 并选择较小的值作为基准值\r\n     * 默认: width\r\n     */\r\n    remResizeDependency: RemResizeDependency.Width,\r\n    /**\r\n     * 标记当前客户端, 参考值 pc | mobile\r\n     */\r\n    client: undefined,\r\n    /**\r\n     * 禁止 ReportPlanNotWorkingErrorOnce\r\n     */\r\n    disableReportPlanNotWorkingErrorOnce: true,\r\n    /**\r\n     * 是否修复手动在(浏览器)中设置字体大小, 这会导致在 rem 方案中让响应式失效\r\n     */\r\n    fixRemManualSettingFontResize: true,\r\n    /**\r\n     * 在应用方案前进行相关处理\r\n     */\r\n    onBeforeApplyPlan: noop,\r\n    /**\r\n     * 仅执行一次响应式方案, 这样的目的是在 resize 后不对页面响应式继续做其他操作\r\n     */\r\n    applyResponsePlanOnce: false\r\n  };\r\n\r\n  /**\r\n   * 合并外部API Options\r\n   * @type {{enableBodyFontSize: boolean, enableViewpointFitForIphoneX: boolean, disableReportPlanNotWorkingErrorOnce: boolean, Plan: {ScaleRatio: number, Viewpoint: number, Rem: number, TargetDensityDpi: number}, onBeforeApplyPlan: (function(*): *), designViewpoint: number, remUpperResizeLimit: number, plans: number[], remResizeDependency: string, namespace: string, fixRemManualSettingFontResize: boolean, client: undefined, getMetaViewpointScaleRatioContent, (*, *=): string, isMobile: (function(): boolean), remRatio: number, getMetaViewpointTargetDensityDpiContent, (*, *=): string}|*|{}}\r\n   */\r\n  const metaFlexibleOptions = {...defaultMetaFlexibleOptions, ...apiMetaFlexibleOptions};\r\n\r\n  /**\r\n   * 拉取 meta TargetDensityDpiContent 模板\r\n   */\r\n  const getMetaViewpointTargetDensityDpiContent = metaFlexibleOptions.getMetaViewpointTargetDensityDpiContent;\r\n\r\n  /**\r\n   * 拉取 meta ScaleRatio 模板\r\n   * @param scale\r\n   * @returns {string}\r\n   */\r\n  const getMetaViewpointScaleRatioContent = metaFlexibleOptions.getMetaViewpointScaleRatioContent;\r\n\r\n  /**\r\n   * 命名空间\r\n   * @type {string}\r\n   */\r\n  const NAMESPACE = metaFlexibleOptions.namespace;\r\n\r\n  /**\r\n   * 错误前缀\r\n   * @type {string}\r\n   */\r\n  const LOG_PREFIX = NAMESPACE;\r\n\r\n  /**\r\n   * 设计稿大小\r\n   * @type {number}\r\n   */\r\n  const designViewpoint = metaFlexibleOptions.designViewpoint;\r\n\r\n  /**\r\n   * 是否启用viewpoint fit, 该属性仅对iphone-x生效\r\n   * @type {boolean}\r\n   */\r\n  const enableViewpointFitForIphoneX = metaFlexibleOptions.enableViewpointFitForIphoneX;\r\n\r\n  /**\r\n   * 拉取 document 元素\r\n   * @type {Element}\r\n   */\r\n  const docEl = document.documentElement;\r\n\r\n  // noinspection JSUnresolvedVariable\r\n  /**\r\n   * 判断当前 window dpr 比例，若无直接降级使用 1\r\n   * @type {*|number}\r\n   */\r\n  const dpr = window.devicePixelRatio || 1;\r\n\r\n  /**\r\n   * plan 列表\r\n   */\r\n  // const plans = metaFlexibleOptions.plans;\r\n\r\n  /**\r\n   * rem的基准值, 如 remRatio = 10, 即在750px设计稿中, 1rem = 75px\r\n   */\r\n  // const remRatio = metaFlexibleOptions.remRatio;\r\n\r\n  /**\r\n   * rem 页面宽度变化最大上限, 当大于 remUpperResizeLimit, 根节点 font-size 将不再变化\r\n   */\r\n  // const remUpperResizeLimit = metaFlexibleOptions.remUpperResizeLimit;\r\n  /**\r\n   * 禁止 ReportPlanNotWorkingErrorOnce\r\n   */\r\n  // const disableReportPlanNotWorkingErrorOnce = metaFlexibleOptions.disableReportPlanNotWorkingErrorOnce;\r\n  /*\r\n   * rem 缩放基准依赖, 有效值为 width|height|auto\r\n   * 当缩放基准依赖为 width 时, 页面会根据宽度缩放而变化 html root 的 fontSize 大小\r\n   * 当缩放基准依赖为 height 时, 页面会根据高度缩放而变化 html root 的 fontSize 大小\r\n   * 当缩放基准依赖为 auto 时, 页面会根据宽高比决定, 并选择较小的值作为基准值\r\n   * 默认: width\r\n   */\r\n  // const remResizeDependency = metaFlexibleOptions.remResizeDependency;\r\n  /**\r\n   * 是否修复手动在(浏览器)中设置字体大小, 这会导致在 rem 方案中让响应式失效\r\n   * @type {boolean}\r\n   */\r\n  // const fixRemManualSettingFontResize = metaFlexibleOptions.fixRemManualSettingFontResize;\r\n\r\n  /**\r\n   * 在页面 resize 时触发\r\n   * @type {function(*): *}\r\n   */\r\n\r\n  // const onBeforeResize = metaFlexibleOptions.onBeforeResize;\r\n\r\n  /**\r\n   * 条件判错函数\r\n   * @param condition 错误条件\r\n   * @param message\r\n   */\r\n  function invariant(condition, message) {\r\n    if (!condition) {\r\n      throw new Error(`${LOG_PREFIX}: ${message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 条件警告函数\r\n   * @param condition 警告条件\r\n   * @param message 警告信息\r\n   */\r\n  function warn(condition, message) {\r\n    if (!condition) {\r\n      // eslint-disable-next-line no-console\r\n      console.warn(`${LOG_PREFIX}: ${message}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 判定页面中是否已经被手动设置 meta\r\n   */\r\n  function invariantMetaViewPoint() {\r\n    const metaViewPointElement = getMetaViewpointElement();\r\n    invariant(!metaViewPointElement, '在使用当前工具库时请勿使用自定义viewpoint meta. viewpoint meta 将会通过当前工具自动计算生成.');\r\n  }\r\n\r\n  /**\r\n   * 获取 meta viewpoint\r\n   */\r\n  function getMetaViewpointElement() {\r\n    return document.querySelector('meta[name=\"viewport\"]');\r\n  }\r\n\r\n  /**\r\n   * 设置 body 字体大小, 来自原本的 lib-flexible 源码, 作用暂未知\r\n   */\r\n  function setBodyFontSize() {\r\n    if (document.body) {\r\n      document.body.style.fontSize = (12 * dpr) + 'px';\r\n    } else {\r\n      document.addEventListener('DOMContentLoaded', setBodyFontSize);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 创建或更新 meta view point\r\n   * @param metaViewpoint {Element} - 如果传入的 metaViewpoint已经存在, 则直接更新即可\r\n   * @param content {String} - viewpoint 内容\r\n   * @returns {*}\r\n   */\r\n  function createOrUpdateMetaViewpoint(metaViewpoint, content) {\r\n    const isAppended = !!metaViewpoint;\r\n    if (isAppended) {\r\n      metaViewpoint.setAttribute('content', content);\r\n    } else {\r\n      const metaViewpointElement = getMetaViewpointElement();\r\n      if (!metaViewpointElement) {\r\n        metaViewpoint = document.createElement('meta');\r\n        metaViewpoint.setAttribute('name', 'viewport');\r\n      } else {\r\n        metaViewpoint = metaViewpointElement;\r\n      }\r\n      metaViewpoint.setAttribute('content', content);\r\n      const headElement = docEl.querySelector('head');\r\n      if (headElement) {\r\n        headElement.appendChild(metaViewpoint);\r\n      } else {\r\n        const wrap = document.createElement('div');\r\n        wrap.appendChild(metaViewpoint);\r\n        document.write(wrap.innerHTML);\r\n      }\r\n    }\r\n    return metaViewpoint;\r\n  }\r\n\r\n  /**\r\n   * 设置 targetDensityDpi meta\r\n   */\r\n  const setMetaViewpointTargetDensityDpi = (() => {\r\n    let isAppended = false;\r\n    let orientationChangeCounter = 0;\r\n    return () => {\r\n      if (!isAppended) {\r\n        createOrUpdateMetaViewpoint(void 0, getMetaViewpointTargetDensityDpiContent(designViewpoint, enableViewpointFitForIphoneX));\r\n        /**\r\n         * 处理在 ios iphone 6 (可能也涉及其他机型), 在翻转手机后当值 targetdensity 方案失效, window.innerWidth 异常, 不等于 designViewpoint\r\n         */\r\n        window.addEventListener('orientationchange', () => {\r\n          /**\r\n           * 且这个行为发生在翻转过程的某一个时间点, 所以需要等待若干时间, 目前测试等待setTimeout时间, 100 (无效), 150 (偶然), 200(可用), 250(较稳)\r\n           * 但不确定是否可能在性能低的时候翻转时间延长导致失效\r\n           */\r\n          setTimeout(() => {\r\n            if (window.innerWidth !== designViewpoint) {\r\n              orientationChangeCounter++;\r\n              if (orientationChangeCounter > 5) {\r\n                orientationChangeCounter = 0;\r\n              }\r\n              createOrUpdateMetaViewpoint(void 0, getMetaViewpointTargetDensityDpiContent(designViewpoint + orientationChangeCounter / 1000, enableViewpointFitForIphoneX));\r\n            }\r\n          }, 250);\r\n        });\r\n        isAppended = true;\r\n      }\r\n    };\r\n  })();\r\n\r\n  /**\r\n   * 设置 targetDensityDpi meta\r\n   */\r\n  const setMetaViewpointScaleRatio = (() => {\r\n    let metaViewpoint;\r\n    /**\r\n     * 缓存先前scale值\r\n     */\r\n    let prevScale;\r\n    return (scale) => {\r\n      if (prevScale !== scale) {\r\n        prevScale = scale;\r\n        metaViewpoint = createOrUpdateMetaViewpoint(metaViewpoint, getMetaViewpointScaleRatioContent(scale, enableViewpointFitForIphoneX));\r\n      }\r\n    };\r\n  })();\r\n\r\n  /**\r\n   * 上报错误, 异步抛异常, 用于上报\r\n   */\r\n  const reportPlanNotWorkingErrorOnce = (() => {\r\n    const hasReported = false;\r\n    return () => {\r\n      const errorMessage = `${NAMESPACE}所使用的所有方案失效, 暂用最后一种方案兜底`;\r\n      if (!metaFlexibleOptions.disableReportPlanNotWorkingErrorOnce) {\r\n        if (!hasReported) {\r\n          setTimeout(() => invariant(false, errorMessage), 0);\r\n        }\r\n      } else {\r\n        // eslint-disable-next-line no-console\r\n        console.warn(errorMessage);\r\n      }\r\n    };\r\n  })();\r\n\r\n  /**\r\n   * 应用响应式方案\r\n   */\r\n  const applyResponsePlan = (() => {\r\n    /**\r\n     * 是否生效,默认情况下是No\r\n     */\r\n    let hasImpact = Impact.No;\r\n    /**\r\n     * 用于存储当前方案\r\n     */\r\n    let currentPlan;\r\n\r\n    return () => {\r\n      /**\r\n       * 在方案之前之前允许用户更新或操作 metaFlexible\r\n       * TODO: 当修改 plan 时可能会出现与闭包缓存值不一致的场景\r\n       */\r\n      metaFlexibleOptions.onBeforeApplyPlan(metaFlexibleOptions);\r\n\r\n      /**\r\n       * 如果已经发现当前方案已生效, 直接使用当前方案即可, 不再继续尝试后续方案\r\n       */\r\n      if (hasImpact === Impact.Yes) {\r\n        /**\r\n         * 第一个方案作为当前使用方案\r\n         */\r\n        implementPlan(currentPlan);\r\n        return;\r\n      }\r\n      if (metaFlexibleOptions.plans.length === 0) {\r\n        hasImpact = Impact.Yes;\r\n        implementPlan(currentPlan);\r\n        return;\r\n      }\r\n      while (hasImpact === Impact.No) {\r\n        if (metaFlexibleOptions.plans[0] !== undefined) {\r\n          /**\r\n           * 指向当前方案\r\n           */\r\n          currentPlan = metaFlexibleOptions.plans[0];\r\n        }\r\n        /**\r\n         * 如果所有方案失效, 直接抛异常, 用于上报, 但保留最后一种方案\r\n         */\r\n        if (metaFlexibleOptions.plans.length <= 0) {\r\n          reportPlanNotWorkingErrorOnce();\r\n          break;\r\n        }\r\n        /**\r\n         * 是否有生效\r\n         */\r\n        hasImpact = hasPlanImpact(() => implementPlan(currentPlan));\r\n        /**\r\n         * 如果发现方案失效, 直接抛弃方案列表第一项\r\n         */\r\n        if (hasImpact === Impact.No) {\r\n          metaFlexibleOptions.plans.shift();\r\n        }\r\n      }\r\n      /**\r\n       * 当是否生效是未知时, 如: 当前页面大小完全等于预设的值 (设计稿大小), 那么无法判断是否生效\r\n       * 当出现以上情况时, 重置 hasImpact = 无效, 让下一轮再次触发当前函数时在判定\r\n       */\r\n      hasImpact === Impact.Unknown && (hasImpact = Impact.No);\r\n    };\r\n  })();\r\n\r\n  /**\r\n   * 方案具体实现函数, 根据枚举选择方案\r\n   */\r\n  function implementPlan(currentPlan) {\r\n    switch (currentPlan) {\r\n      case Plan.TargetDensityDpi:\r\n        targetDensityDpiImpl();\r\n        break;\r\n      case Plan.ScaleRatio:\r\n        scaleRatioImpl();\r\n        break;\r\n      case Plan.Rem:\r\n        remImpl();\r\n        break;\r\n      case Plan.Viewpoint:\r\n        viewpointImpl();\r\n        break;\r\n      default:\r\n        invariant(false, `未知 meta-flexible 方案, plan = ${currentPlan}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * rem 方案具体实现\r\n   */\r\n  function remImpl() {\r\n    setMetaViewpointScaleRatio(1);\r\n    refreshRem();\r\n  }\r\n\r\n  /**\r\n   * viewpoint 方案具体实现\r\n   */\r\n  function viewpointImpl() {\r\n    setMetaViewpointScaleRatio(1);\r\n    refreshRem(false);\r\n  }\r\n\r\n  /**\r\n   * 刷新Rem\r\n   * @param hasResizeLimit\r\n   */\r\n  function refreshRem(hasResizeLimit = true) {\r\n    let base;\r\n    const {remResizeDependency, remUpperResizeLimit, remRatio, fixRemManualSettingFontResize} = metaFlexibleOptions;\r\n    if (remResizeDependency === RemResizeDependency.Width) {\r\n      base = docEl.clientWidth;\r\n    } else if (remResizeDependency === RemResizeDependency.Height) {\r\n      base = docEl.clientHeight;\r\n    } else if (remResizeDependency === RemResizeDependency.Auto || remResizeDependency === RemResizeDependency.UseSmallerSize) {\r\n      base = Math.min(docEl.clientWidth, docEl.clientHeight);\r\n    } else if (remResizeDependency === RemResizeDependency.UseBiggerSize) {\r\n      base = Math.max(docEl.clientWidth, docEl.clientHeight);\r\n    }\r\n    if (hasResizeLimit) {\r\n      if (base > remUpperResizeLimit) {\r\n        base = remUpperResizeLimit;\r\n      }\r\n    }\r\n    let rem = base / remRatio;\r\n    if (fixRemManualSettingFontResize) {\r\n      rem = rem / computeDiffFontSizeRatio();\r\n    }\r\n    docEl.style.fontSize = `${rem}px`;\r\n    apiMetaFlexibleOptions.rem = rem;\r\n  }\r\n\r\n  /**\r\n   * target density dpi 具体实现\r\n   */\r\n  function targetDensityDpiImpl() {\r\n    setMetaViewpointTargetDensityDpi();\r\n  }\r\n\r\n  /**\r\n   * target density dpi 具体实现\r\n   */\r\n  function scaleRatioImpl() {\r\n    const width = getScreenWidth();\r\n    let scale = width / designViewpoint;\r\n    scale > 1 && (scale = 1);\r\n    setMetaViewpointScaleRatio(scale);\r\n  }\r\n\r\n  /**\r\n   * 检查发现支持0.5px\r\n   */\r\n  function tryAddHairLine() {\r\n    if (dpr >= 2) {\r\n      const fakeBody = document.createElement('body');\r\n      const testElement = document.createElement('div');\r\n      testElement.style.border = '.5px solid transparent';\r\n      fakeBody.appendChild(testElement);\r\n      docEl.appendChild(fakeBody);\r\n      if (testElement.offsetHeight === 1) {\r\n        docEl.classList.add('hairlines');\r\n      }\r\n      docEl.removeChild(fakeBody);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * 方案是否有生效\r\n   * @param action\r\n   */\r\n  function hasPlanImpact(action) {\r\n    const clientWidthBeforeMeta = docEl.clientWidth;\r\n    action();\r\n    const clientWidthAfterMeta = docEl.clientWidth;\r\n    if (getScreenWidth() === designViewpoint) {\r\n      return Impact.Unknown;\r\n    }\r\n    return clientWidthAfterMeta === clientWidthBeforeMeta ? Impact.No : Impact.Yes;\r\n  }\r\n\r\n  /**\r\n   * 获取当前屏幕宽度\r\n   * @returns {Number}\r\n   */\r\n  function getScreenWidth() {\r\n    return window.screen.width;\r\n  }\r\n\r\n  (function () {\r\n\r\n    const {enableBodyFontSize, isMobile} = metaFlexibleOptions;\r\n\r\n    if (!isMobile()) {\r\n      warn(false, `请确保在移动端下使用${NAMESPACE}`);\r\n      return;\r\n    }\r\n\r\n    /**\r\n     * 校验判断 meta viewpoint, 禁止开发者手动添加\r\n     */\r\n    invariantMetaViewPoint();\r\n\r\n    if (enableBodyFontSize) {\r\n      /**\r\n       * 立即自执行, 设置 body font size\r\n       */\r\n      setBodyFontSize();\r\n    }\r\n    /**\r\n     * 直接触发页面\r\n     */\r\n    applyResponsePlan();\r\n\r\n\r\n    if (!metaFlexibleOptions.applyResponsePlanOnce) {\r\n      /**\r\n       * 在页面大小变更时触发更新\r\n       */\r\n      window.addEventListener('resize', (function () {\r\n        let timeoutId;\r\n        return () => {\r\n          clearTimeout(timeoutId);\r\n          timeoutId = setTimeout(applyResponsePlan, 300);\r\n        };\r\n      }()));\r\n    }\r\n\r\n    /**\r\n     * onpageshow 事件类似于 onload 事件，onload 事件在页面第一次加载时触发，\r\n     * onpageshow 事件在每次加载页面时触发，即 onload 事件在页面从浏览器缓存中读取时不触发\r\n     */\r\n    window.addEventListener('pageshow', (e) => {\r\n      /** @namespace e.persisted */\r\n      e.persisted && applyResponsePlan();\r\n    }, false);\r\n\r\n    /**\r\n     * 尝试加入 Hairline 标记, 用于处理 border 1px的问题\r\n     */\r\n    tryAddHairLine();\r\n\r\n    /**\r\n     * 向外部曝露applyResponsePlan\r\n     * @type {Function}\r\n     */\r\n    apiMetaFlexibleOptions.applyResponsePlan = applyResponsePlan;\r\n  }());\r\n}(window, document, window.__META_FLEXIBLE__ = window.__META_FLEXIBLE__ || {}));\r\n"],"names":["window","document","apiMetaFlexibleOptions","invariant","condition","message","Error","LOG_PREFIX","warn","invariantMetaViewPoint","getMetaViewpointElement","querySelector","setBodyFontSize","body","style","fontSize","dpr","addEventListener","createOrUpdateMetaViewpoint","metaViewpoint","content","metaViewpointElement","createElement","setAttribute","headElement","docEl","appendChild","wrap","write","innerHTML","implementPlan","currentPlan","Plan","TargetDensityDpi","ScaleRatio","Rem","Viewpoint","remImpl","viewpointImpl","refreshRem","hasResizeLimit","base","remResizeDependency","metaFlexibleOptions","remUpperResizeLimit","remRatio","fixRemManualSettingFontResize","RemResizeDependency","Width","clientWidth","Height","clientHeight","Auto","UseSmallerSize","Math","min","UseBiggerSize","max","rem","computeDiffFontSizeRatio","targetDensityDpiImpl","scaleRatioImpl","width","getScreenWidth","scale","designViewpoint","tryAddHairLine","fakeBody","testElement","border","offsetHeight","classList","add","removeChild","hasPlanImpact","action","clientWidthBeforeMeta","clientWidthAfterMeta","Impact","Unknown","No","Yes","screen","version","diffFontSizeRatio","computeActualFontSize","getComputedStyle","documentElement","getPropertyValue","replace","rawDocElementCssText","cssText","actualFontSize","noop","f","defaultMetaFlexibleOptions","enableViewpointFitForIphoneX","filter","Boolean","join","test","navigator","userAgent","undefined","getMetaViewpointTargetDensityDpiContent","getMetaViewpointScaleRatioContent","NAMESPACE","namespace","devicePixelRatio","setMetaViewpointTargetDensityDpi","isAppended","orientationChangeCounter","innerWidth","setMetaViewpointScaleRatio","prevScale","reportPlanNotWorkingErrorOnce","errorMessage","disableReportPlanNotWorkingErrorOnce","applyResponsePlan","hasImpact","onBeforeApplyPlan","plans","length","shift","enableBodyFontSize","isMobile","applyResponsePlanOnce","timeoutId","setTimeout","e","persisted","__META_FLEXIBLE__"],"mappings":"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"}